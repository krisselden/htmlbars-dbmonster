exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _fragmentOpcodeCompiler = require('./fragment-opcode-compiler');

var _fragmentOpcodeCompiler2 = _interopRequireDefault(_fragmentOpcodeCompiler);

var _fragmentJavascriptCompiler = require('./fragment-javascript-compiler');

var _fragmentJavascriptCompiler2 = _interopRequireDefault(_fragmentJavascriptCompiler);

var _hydrationOpcodeCompiler = require('./hydration-opcode-compiler');

var _hydrationOpcodeCompiler2 = _interopRequireDefault(_hydrationOpcodeCompiler);

var _hydrationJavascriptCompiler = require('./hydration-javascript-compiler');

var _hydrationJavascriptCompiler2 = _interopRequireDefault(_hydrationJavascriptCompiler);

var _templateVisitor = require("./template-visitor");

var _templateVisitor2 = _interopRequireDefault(_templateVisitor);

var _utils = require("./utils");

var _htmlbarsUtilQuoting = require("../htmlbars-util/quoting");

var _htmlbarsUtilArrayUtils = require("../htmlbars-util/array-utils");

function TemplateCompiler(options) {
  this.options = options || {};
  this.consumerBuildMeta = this.options.buildMeta || function () {};
  this.fragmentOpcodeCompiler = new _fragmentOpcodeCompiler2.default();
  this.fragmentCompiler = new _fragmentJavascriptCompiler2.default();
  this.hydrationOpcodeCompiler = new _hydrationOpcodeCompiler2.default();
  this.hydrationCompiler = new _hydrationJavascriptCompiler2.default();
  this.templates = [];
  this.childTemplates = [];
}

exports.default = TemplateCompiler;

var dynamicNodes = {
  mustache: true,
  block: true,
  component: true
};

TemplateCompiler.prototype.compile = function (ast) {
  var templateVisitor = new _templateVisitor2.default();
  templateVisitor.visit(ast);

  var normalizedActions = [];
  var actions = templateVisitor.actions;

  for (var i = 0, l = actions.length - 1; i < l; i++) {
    var action = actions[i];
    var nextAction = actions[i + 1];

    normalizedActions.push(action);

    if (action[0] === "startProgram" && nextAction[0] in dynamicNodes) {
      normalizedActions.push(['insertBoundary', [true]]);
    }

    if (nextAction[0] === "endProgram" && action[0] in dynamicNodes) {
      normalizedActions.push(['insertBoundary', [false]]);
    }
  }

  normalizedActions.push(actions[actions.length - 1]);

  _utils.processOpcodes(this, normalizedActions);

  return this.templates.pop();
};

TemplateCompiler.prototype.startProgram = function (program, childTemplateCount, blankChildTextNodes) {
  this.fragmentOpcodeCompiler.startProgram(program, childTemplateCount, blankChildTextNodes);
  this.hydrationOpcodeCompiler.startProgram(program, childTemplateCount, blankChildTextNodes);

  this.childTemplates.length = 0;
  while (childTemplateCount--) {
    this.childTemplates.push(this.templates.pop());
  }
};

TemplateCompiler.prototype.insertBoundary = function (first) {
  this.hydrationOpcodeCompiler.insertBoundary(first);
};

TemplateCompiler.prototype.getChildTemplateVars = function (indent) {
  var vars = '';
  if (this.childTemplates) {
    for (var i = 0; i < this.childTemplates.length; i++) {
      vars += indent + 'var child' + i + ' = ' + this.childTemplates[i] + ';\n';
    }
  }
  return vars;
};

TemplateCompiler.prototype.getHydrationHooks = function (indent, hooks) {
  var hookVars = [];
  for (var hook in hooks) {
    hookVars.push(hook + ' = hooks.' + hook);
  }

  if (hookVars.length > 0) {
    return indent + 'var hooks = env.hooks, ' + hookVars.join(', ') + ';\n';
  } else {
    return '';
  }
};

TemplateCompiler.prototype.endProgram = function (program, programDepth) {
  this.fragmentOpcodeCompiler.endProgram(program);
  this.hydrationOpcodeCompiler.endProgram(program);

  var indent = _htmlbarsUtilQuoting.repeat("  ", programDepth);
  var options = {
    indent: indent + "    "
  };

  // function build(dom) { return fragment; }
  var fragmentProgram = this.fragmentCompiler.compile(this.fragmentOpcodeCompiler.opcodes, options);

  // function hydrate(fragment) { return mustaches; }
  var hydrationPrograms = this.hydrationCompiler.compile(this.hydrationOpcodeCompiler.opcodes, options);

  var blockParams = program.blockParams || [];

  var templateSignature = 'context, rootNode, env, options';
  if (blockParams.length > 0) {
    templateSignature += ', blockArguments';
  }

  var statements = _htmlbarsUtilArrayUtils.map(hydrationPrograms.statements, function (s) {
    return indent + '      ' + JSON.stringify(s);
  }).join(",\n");

  var locals = JSON.stringify(hydrationPrograms.locals);

  var templates = _htmlbarsUtilArrayUtils.map(this.childTemplates, function (_, index) {
    return 'child' + index;
  }).join(', ');

  var template = '(function() {\n' + this.getChildTemplateVars(indent + '  ') + indent + '  return {\n' + this.buildMeta(indent + '    ', program) + indent + '    arity: ' + blockParams.length + ',\n' + indent + '    cachedFragment: null,\n' + indent + '    hasRendered: false,\n' + indent + '    buildFragment: ' + fragmentProgram + ',\n' + indent + '    buildRenderNodes: ' + hydrationPrograms.createMorphsProgram + ',\n' + indent + '    statements: [\n' + statements + '\n' + indent + '    ],\n' + indent + '    locals: ' + locals + ',\n' + indent + '    templates: [' + templates + ']\n' + indent + '  };\n' + indent + '}())';

  this.templates.push(template);
};

TemplateCompiler.prototype.buildMeta = function (indent, program) {
  var meta = this.consumerBuildMeta(program) || {};

  var head = indent + 'meta: ';
  var stringMeta = JSON.stringify(meta, null, 2).replace(/\n/g, '\n' + indent);
  var tail = ',\n';

  return head + stringMeta + tail;
};

TemplateCompiler.prototype.openElement = function (element, i, l, r, c, b) {
  this.fragmentOpcodeCompiler.openElement(element, i, l, r, c, b);
  this.hydrationOpcodeCompiler.openElement(element, i, l, r, c, b);
};

TemplateCompiler.prototype.closeElement = function (element, i, l, r) {
  this.fragmentOpcodeCompiler.closeElement(element, i, l, r);
  this.hydrationOpcodeCompiler.closeElement(element, i, l, r);
};

TemplateCompiler.prototype.component = function (component, i, l, s) {
  this.fragmentOpcodeCompiler.component(component, i, l, s);
  this.hydrationOpcodeCompiler.component(component, i, l, s);
};

TemplateCompiler.prototype.block = function (block, i, l, s) {
  this.fragmentOpcodeCompiler.block(block, i, l, s);
  this.hydrationOpcodeCompiler.block(block, i, l, s);
};

TemplateCompiler.prototype.text = function (string, i, l, r) {
  this.fragmentOpcodeCompiler.text(string, i, l, r);
  this.hydrationOpcodeCompiler.text(string, i, l, r);
};

TemplateCompiler.prototype.comment = function (string, i, l, r) {
  this.fragmentOpcodeCompiler.comment(string, i, l, r);
  this.hydrationOpcodeCompiler.comment(string, i, l, r);
};

TemplateCompiler.prototype.mustache = function (mustache, i, l, s) {
  this.fragmentOpcodeCompiler.mustache(mustache, i, l, s);
  this.hydrationOpcodeCompiler.mustache(mustache, i, l, s);
};

TemplateCompiler.prototype.setNamespace = function (namespace) {
  this.fragmentOpcodeCompiler.setNamespace(namespace);
};
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxiYXJzLWNvbXBpbGVyL3RlbXBsYXRlLWNvbXBpbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7c0NBQW1DLDRCQUE0Qjs7OzswQ0FDeEIsZ0NBQWdDOzs7O3VDQUNuQyw2QkFBNkI7Ozs7MkNBQ3pCLGlDQUFpQzs7OzsrQkFDN0Msb0JBQW9COzs7O3FCQUNqQixTQUFTOzttQ0FDakIsMEJBQTBCOztzQ0FDN0IsOEJBQThCOztBQUVsRCxTQUFTLGdCQUFnQixDQUFDLE9BQU8sRUFBRTtBQUNqQyxNQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7QUFDN0IsTUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxJQUFJLFlBQVcsRUFBRSxDQUFDO0FBQ2pFLE1BQUksQ0FBQyxzQkFBc0IsR0FBRyxzQ0FBNEIsQ0FBQztBQUMzRCxNQUFJLENBQUMsZ0JBQWdCLEdBQUcsMENBQWdDLENBQUM7QUFDekQsTUFBSSxDQUFDLHVCQUF1QixHQUFHLHVDQUE2QixDQUFDO0FBQzdELE1BQUksQ0FBQyxpQkFBaUIsR0FBRywyQ0FBaUMsQ0FBQztBQUMzRCxNQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztBQUNwQixNQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztDQUMxQjs7a0JBRWMsZ0JBQWdCOztBQUUvQixJQUFJLFlBQVksR0FBRztBQUNqQixVQUFRLEVBQUUsSUFBSTtBQUNkLE9BQUssRUFBRSxJQUFJO0FBQ1gsV0FBUyxFQUFFLElBQUk7Q0FDaEIsQ0FBQzs7QUFFRixnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLFVBQVMsR0FBRyxFQUFFO0FBQ2pELE1BQUksZUFBZSxHQUFHLCtCQUFxQixDQUFDO0FBQzVDLGlCQUFlLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUUzQixNQUFJLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztBQUMzQixNQUFJLE9BQU8sR0FB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Q0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztDQUNwRCxDQUFDOztBQUVGLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsVUFBUyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDN0QsTUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNyRCxNQUFJLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0NBQ3ZELENBQUM7O0FBRUYsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxVQUFVLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUNqRSxNQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3hELE1BQUksQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Q0FDMUQsQ0FBQzs7QUFFRixnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsWUFBWSxHQUFHLFVBQVMsU0FBUyxFQUFFO0FBQzVELE1BQUksQ0FBQyxzQkFBc0IsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7Q0FDckQsQ0FBQyIsImZpbGUiOiJodG1sYmFycy1jb21waWxlci90ZW1wbGF0ZS1jb21waWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBGcmFnbWVudE9wY29kZUNvbXBpbGVyIGZyb20gJy4vZnJhZ21lbnQtb3Bjb2RlLWNvbXBpbGVyJztcbmltcG9ydCBGcmFnbWVudEphdmFTY3JpcHRDb21waWxlciBmcm9tICcuL2ZyYWdtZW50LWphdmFzY3JpcHQtY29tcGlsZXInO1xuaW1wb3J0IEh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyIGZyb20gJy4vaHlkcmF0aW9uLW9wY29kZS1jb21waWxlcic7XG5pbXBvcnQgSHlkcmF0aW9uSmF2YVNjcmlwdENvbXBpbGVyIGZyb20gJy4vaHlkcmF0aW9uLWphdmFzY3JpcHQtY29tcGlsZXInO1xuaW1wb3J0IFRlbXBsYXRlVmlzaXRvciBmcm9tIFwiLi90ZW1wbGF0ZS12aXNpdG9yXCI7XG5pbXBvcnQgeyBwcm9jZXNzT3Bjb2RlcyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyByZXBlYXQgfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbC9xdW90aW5nXCI7XG5pbXBvcnQgeyBtYXAgfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbC9hcnJheS11dGlsc1wiO1xuXG5mdW5jdGlvbiBUZW1wbGF0ZUNvbXBpbGVyKG9wdGlvbnMpIHtcbiAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdGhpcy5jb25zdW1lckJ1aWxkTWV0YSA9IHRoaXMub3B0aW9ucy5idWlsZE1ldGEgfHwgZnVuY3Rpb24oKSB7fTtcbiAgdGhpcy5mcmFnbWVudE9wY29kZUNvbXBpbGVyID0gbmV3IEZyYWdtZW50T3Bjb2RlQ29tcGlsZXIoKTtcbiAgdGhpcy5mcmFnbWVudENvbXBpbGVyID0gbmV3IEZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyKCk7XG4gIHRoaXMuaHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIgPSBuZXcgSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIoKTtcbiAgdGhpcy5oeWRyYXRpb25Db21waWxlciA9IG5ldyBIeWRyYXRpb25KYXZhU2NyaXB0Q29tcGlsZXIoKTtcbiAgdGhpcy50ZW1wbGF0ZXMgPSBbXTtcbiAgdGhpcy5jaGlsZFRlbXBsYXRlcyA9IFtdO1xufVxuXG5leHBvcnQgZGVmYXVsdCBUZW1wbGF0ZUNvbXBpbGVyO1xuXG52YXIgZHluYW1pY05vZGVzID0ge1xuICBtdXN0YWNoZTogdHJ1ZSxcbiAgYmxvY2s6IHRydWUsXG4gIGNvbXBvbmVudDogdHJ1ZVxufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uKGFzdCkge1xuICB2YXIgdGVtcGxhdGVWaXNpdG9yID0gbmV3IFRlbXBsYXRlVmlzaXRvcigpO1xuICB0ZW1wbGF0ZVZpc2l0b3IudmlzaXQoYXN0KTtcblxuICB2YXIgbm9ybWFsaXplZEFjdGlvbnMgPSBbXTtcbiAgdmFyIGFjdGlvbnMgPSB0ZW1wbGF0ZVZpc2l0b3IuYWN0aW9ucztcblxuICBmb3IgKHZhciBpPTAsIGw9YWN0aW9ucy5sZW5ndGggLSAxOyBpPGw7IGkrKykge1xuICAgIHZhciBhY3Rpb24gPSBhY3Rpb25zW2ldO1xuICAgIHZhciBuZXh0QWN0aW9uID0gYWN0aW9uc1tpICsgMV07XG5cbiAgICBub3JtYWxpemVkQWN0aW9ucy5wdXNoKGFjdGlvbik7XG5cbiAgICBpZiAoYWN0aW9uWzBdID09PSBcInN0YXJ0UHJvZ3JhbVwiICYmIG5leHRBY3Rpb25bMF0gaW4gZHluYW1pY05vZGVzKSB7XG4gICAgICBub3JtYWxpemVkQWN0aW9ucy5wdXNoKFsnaW5zZXJ0Qm91bmRhcnknLCBbdHJ1ZV1dKTtcbiAgICB9XG5cbiAgICBpZiAobmV4dEFjdGlvblswXSA9PT0gXCJlbmRQcm9ncmFtXCIgJiYgYWN0aW9uWzBdIGluIGR5bmFtaWNOb2Rlcykge1xuICAgICAgbm9ybWFsaXplZEFjdGlvbnMucHVzaChbJ2luc2VydEJvdW5kYXJ5JywgW2ZhbHNlXV0pO1xuICAgIH1cbiAgfVxuXG4gIG5vcm1hbGl6ZWRBY3Rpb25zLnB1c2goYWN0aW9uc1thY3Rpb25zLmxlbmd0aCAtIDFdKTtcblxuICBwcm9jZXNzT3Bjb2Rlcyh0aGlzLCBub3JtYWxpemVkQWN0aW9ucyk7XG5cbiAgcmV0dXJuIHRoaXMudGVtcGxhdGVzLnBvcCgpO1xufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuc3RhcnRQcm9ncmFtID0gZnVuY3Rpb24ocHJvZ3JhbSwgY2hpbGRUZW1wbGF0ZUNvdW50LCBibGFua0NoaWxkVGV4dE5vZGVzKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5zdGFydFByb2dyYW0ocHJvZ3JhbSwgY2hpbGRUZW1wbGF0ZUNvdW50LCBibGFua0NoaWxkVGV4dE5vZGVzKTtcbiAgdGhpcy5oeWRyYXRpb25PcGNvZGVDb21waWxlci5zdGFydFByb2dyYW0ocHJvZ3JhbSwgY2hpbGRUZW1wbGF0ZUNvdW50LCBibGFua0NoaWxkVGV4dE5vZGVzKTtcblxuICB0aGlzLmNoaWxkVGVtcGxhdGVzLmxlbmd0aCA9IDA7XG4gIHdoaWxlKGNoaWxkVGVtcGxhdGVDb3VudC0tKSB7XG4gICAgdGhpcy5jaGlsZFRlbXBsYXRlcy5wdXNoKHRoaXMudGVtcGxhdGVzLnBvcCgpKTtcbiAgfVxufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuaW5zZXJ0Qm91bmRhcnkgPSBmdW5jdGlvbihmaXJzdCkge1xuICB0aGlzLmh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLmluc2VydEJvdW5kYXJ5KGZpcnN0KTtcbn07XG5cblRlbXBsYXRlQ29tcGlsZXIucHJvdG90eXBlLmdldENoaWxkVGVtcGxhdGVWYXJzID0gZnVuY3Rpb24oaW5kZW50KSB7XG4gIHZhciB2YXJzID0gJyc7XG4gIGlmICh0aGlzLmNoaWxkVGVtcGxhdGVzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoaWxkVGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXJzICs9IGluZGVudCArICd2YXIgY2hpbGQnICsgaSArICcgPSAnICsgdGhpcy5jaGlsZFRlbXBsYXRlc1tpXSArICc7XFxuJztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhcnM7XG59O1xuXG5UZW1wbGF0ZUNvbXBpbGVyLnByb3RvdHlwZS5nZXRIeWRyYXRpb25Ib29rcyA9IGZ1bmN0aW9uKGluZGVudCwgaG9va3MpIHtcbiAgdmFyIGhvb2tWYXJzID0gW107XG4gIGZvciAodmFyIGhvb2sgaW4gaG9va3MpIHtcbiAgICBob29rVmFycy5wdXNoKGhvb2sgKyAnID0gaG9va3MuJyArIGhvb2spO1xuICB9XG5cbiAgaWYgKGhvb2tWYXJzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gaW5kZW50ICsgJ3ZhciBob29rcyA9IGVudi5ob29rcywgJyArIGhvb2tWYXJzLmpvaW4oJywgJykgKyAnO1xcbic7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG59O1xuXG5UZW1wbGF0ZUNvbXBpbGVyLnByb3RvdHlwZS5lbmRQcm9ncmFtID0gZnVuY3Rpb24ocHJvZ3JhbSwgcHJvZ3JhbURlcHRoKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5lbmRQcm9ncmFtKHByb2dyYW0pO1xuICB0aGlzLmh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLmVuZFByb2dyYW0ocHJvZ3JhbSk7XG5cbiAgdmFyIGluZGVudCA9IHJlcGVhdChcIiAgXCIsIHByb2dyYW1EZXB0aCk7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIGluZGVudDogaW5kZW50ICsgXCIgICAgXCJcbiAgfTtcblxuICAvLyBmdW5jdGlvbiBidWlsZChkb20pIHsgcmV0dXJuIGZyYWdtZW50OyB9XG4gIHZhciBmcmFnbWVudFByb2dyYW0gPSB0aGlzLmZyYWdtZW50Q29tcGlsZXIuY29tcGlsZShcbiAgICB0aGlzLmZyYWdtZW50T3Bjb2RlQ29tcGlsZXIub3Bjb2RlcyxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgLy8gZnVuY3Rpb24gaHlkcmF0ZShmcmFnbWVudCkgeyByZXR1cm4gbXVzdGFjaGVzOyB9XG4gIHZhciBoeWRyYXRpb25Qcm9ncmFtcyA9IHRoaXMuaHlkcmF0aW9uQ29tcGlsZXIuY29tcGlsZShcbiAgICB0aGlzLmh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLm9wY29kZXMsXG4gICAgb3B0aW9uc1xuICApO1xuXG4gIHZhciBibG9ja1BhcmFtcyA9IHByb2dyYW0uYmxvY2tQYXJhbXMgfHwgW107XG5cbiAgdmFyIHRlbXBsYXRlU2lnbmF0dXJlID0gJ2NvbnRleHQsIHJvb3ROb2RlLCBlbnYsIG9wdGlvbnMnO1xuICBpZiAoYmxvY2tQYXJhbXMubGVuZ3RoID4gMCkge1xuICAgIHRlbXBsYXRlU2lnbmF0dXJlICs9ICcsIGJsb2NrQXJndW1lbnRzJztcbiAgfVxuXG4gIHZhciBzdGF0ZW1lbnRzID0gbWFwKGh5ZHJhdGlvblByb2dyYW1zLnN0YXRlbWVudHMsIGZ1bmN0aW9uKHMpIHtcbiAgICByZXR1cm4gaW5kZW50KycgICAgICAnK0pTT04uc3RyaW5naWZ5KHMpO1xuICB9KS5qb2luKFwiLFxcblwiKTtcblxuICB2YXIgbG9jYWxzID0gSlNPTi5zdHJpbmdpZnkoaHlkcmF0aW9uUHJvZ3JhbXMubG9jYWxzKTtcblxuICB2YXIgdGVtcGxhdGVzID0gbWFwKHRoaXMuY2hpbGRUZW1wbGF0ZXMsIGZ1bmN0aW9uKF8sIGluZGV4KSB7XG4gICAgcmV0dXJuICdjaGlsZCcgKyBpbmRleDtcbiAgfSkuam9pbignLCAnKTtcblxuICB2YXIgdGVtcGxhdGUgPVxuICAgICcoZnVuY3Rpb24oKSB7XFxuJyArXG4gICAgdGhpcy5nZXRDaGlsZFRlbXBsYXRlVmFycyhpbmRlbnQgKyAnICAnKSArXG4gICAgaW5kZW50KycgIHJldHVybiB7XFxuJyArXG4gICAgdGhpcy5idWlsZE1ldGEoaW5kZW50KycgICAgJywgcHJvZ3JhbSkgK1xuICAgIGluZGVudCsnICAgIGFyaXR5OiAnICsgYmxvY2tQYXJhbXMubGVuZ3RoICsgJyxcXG4nICtcbiAgICBpbmRlbnQrJyAgICBjYWNoZWRGcmFnbWVudDogbnVsbCxcXG4nICtcbiAgICBpbmRlbnQrJyAgICBoYXNSZW5kZXJlZDogZmFsc2UsXFxuJyArXG4gICAgaW5kZW50KycgICAgYnVpbGRGcmFnbWVudDogJyArIGZyYWdtZW50UHJvZ3JhbSArICcsXFxuJyArXG4gICAgaW5kZW50KycgICAgYnVpbGRSZW5kZXJOb2RlczogJyArIGh5ZHJhdGlvblByb2dyYW1zLmNyZWF0ZU1vcnBoc1Byb2dyYW0gKyAnLFxcbicgK1xuICAgIGluZGVudCsnICAgIHN0YXRlbWVudHM6IFtcXG4nICsgc3RhdGVtZW50cyArICdcXG4nICtcbiAgICBpbmRlbnQrJyAgICBdLFxcbicgK1xuICAgIGluZGVudCsnICAgIGxvY2FsczogJyArIGxvY2FscyArICcsXFxuJyArXG4gICAgaW5kZW50KycgICAgdGVtcGxhdGVzOiBbJyArIHRlbXBsYXRlcyArICddXFxuJyArXG4gICAgaW5kZW50KycgIH07XFxuJyArXG4gICAgaW5kZW50Kyd9KCkpJztcblxuICB0aGlzLnRlbXBsYXRlcy5wdXNoKHRlbXBsYXRlKTtcbn07XG5cblRlbXBsYXRlQ29tcGlsZXIucHJvdG90eXBlLmJ1aWxkTWV0YSA9IGZ1bmN0aW9uKGluZGVudCwgcHJvZ3JhbSkge1xuICB2YXIgbWV0YSA9IHRoaXMuY29uc3VtZXJCdWlsZE1ldGEocHJvZ3JhbSkgfHwge307XG5cbiAgdmFyIGhlYWQgPSBpbmRlbnQrJ21ldGE6ICc7XG4gIHZhciBzdHJpbmdNZXRhID0gSlNPTi5zdHJpbmdpZnkobWV0YSwgbnVsbCwgMikucmVwbGFjZSgvXFxuL2csICdcXG4nICsgaW5kZW50KTtcbiAgdmFyIHRhaWwgPSAnLFxcbic7XG5cbiAgcmV0dXJuIGhlYWQgKyBzdHJpbmdNZXRhICsgdGFpbDtcbn07XG5cblRlbXBsYXRlQ29tcGlsZXIucHJvdG90eXBlLm9wZW5FbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgaSwgbCwgciwgYywgYikge1xuICB0aGlzLmZyYWdtZW50T3Bjb2RlQ29tcGlsZXIub3BlbkVsZW1lbnQoZWxlbWVudCwgaSwgbCwgciwgYywgYik7XG4gIHRoaXMuaHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIub3BlbkVsZW1lbnQoZWxlbWVudCwgaSwgbCwgciwgYywgYik7XG59O1xuXG5UZW1wbGF0ZUNvbXBpbGVyLnByb3RvdHlwZS5jbG9zZUVsZW1lbnQgPSBmdW5jdGlvbihlbGVtZW50LCBpLCBsLCByKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5jbG9zZUVsZW1lbnQoZWxlbWVudCwgaSwgbCwgcik7XG4gIHRoaXMuaHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIuY2xvc2VFbGVtZW50KGVsZW1lbnQsIGksIGwsIHIpO1xufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuY29tcG9uZW50ID0gZnVuY3Rpb24oY29tcG9uZW50LCBpLCBsLCBzKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5jb21wb25lbnQoY29tcG9uZW50LCBpLCBsLCBzKTtcbiAgdGhpcy5oeWRyYXRpb25PcGNvZGVDb21waWxlci5jb21wb25lbnQoY29tcG9uZW50LCBpLCBsLCBzKTtcbn07XG5cblRlbXBsYXRlQ29tcGlsZXIucHJvdG90eXBlLmJsb2NrID0gZnVuY3Rpb24oYmxvY2ssIGksIGwsIHMpIHtcbiAgdGhpcy5mcmFnbWVudE9wY29kZUNvbXBpbGVyLmJsb2NrKGJsb2NrLCBpLCBsLCBzKTtcbiAgdGhpcy5oeWRyYXRpb25PcGNvZGVDb21waWxlci5ibG9jayhibG9jaywgaSwgbCwgcyk7XG59O1xuXG5UZW1wbGF0ZUNvbXBpbGVyLnByb3RvdHlwZS50ZXh0ID0gZnVuY3Rpb24oc3RyaW5nLCBpLCBsLCByKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci50ZXh0KHN0cmluZywgaSwgbCwgcik7XG4gIHRoaXMuaHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIudGV4dChzdHJpbmcsIGksIGwsIHIpO1xufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuY29tbWVudCA9IGZ1bmN0aW9uKHN0cmluZywgaSwgbCwgcikge1xuICB0aGlzLmZyYWdtZW50T3Bjb2RlQ29tcGlsZXIuY29tbWVudChzdHJpbmcsIGksIGwsIHIpO1xuICB0aGlzLmh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLmNvbW1lbnQoc3RyaW5nLCBpLCBsLCByKTtcbn07XG5cblRlbXBsYXRlQ29tcGlsZXIucHJvdG90eXBlLm11c3RhY2hlID0gZnVuY3Rpb24gKG11c3RhY2hlLCBpLCBsLCBzKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5tdXN0YWNoZShtdXN0YWNoZSwgaSwgbCwgcyk7XG4gIHRoaXMuaHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIubXVzdGFjaGUobXVzdGFjaGUsIGksIGwsIHMpO1xufTtcblxuVGVtcGxhdGVDb21waWxlci5wcm90b3R5cGUuc2V0TmFtZXNwYWNlID0gZnVuY3Rpb24obmFtZXNwYWNlKSB7XG4gIHRoaXMuZnJhZ21lbnRPcGNvZGVDb21waWxlci5zZXROYW1lc3BhY2UobmFtZXNwYWNlKTtcbn07XG4iXX0=