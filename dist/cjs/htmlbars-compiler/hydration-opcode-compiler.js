exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _templateVisitor = require("./template-visitor");

var _templateVisitor2 = _interopRequireDefault(_templateVisitor);

var _utils = require("./utils");

var _htmlbarsUtil = require("../htmlbars-util");

var _htmlbarsUtilArrayUtils = require("../htmlbars-util/array-utils");

var _htmlbarsSyntaxUtils = require("../htmlbars-syntax/utils");

function detectIsElementChecked(element) {
  for (var i = 0, len = element.attributes.length; i < len; i++) {
    if (element.attributes[i].name === 'checked') {
      return true;
    }
  }
  return false;
}

function HydrationOpcodeCompiler() {
  this.opcodes = [];
  this.paths = [];
  this.templateId = 0;
  this.currentDOMChildIndex = 0;
  this.morphs = [];
  this.morphNum = 0;
  this.element = null;
  this.elementNum = -1;
}

exports.default = HydrationOpcodeCompiler;

HydrationOpcodeCompiler.prototype.compile = function (ast) {
  var templateVisitor = new _templateVisitor2.default();
  templateVisitor.visit(ast);

  _utils.processOpcodes(this, templateVisitor.actions);

  return this.opcodes;
};

HydrationOpcodeCompiler.prototype.accept = function (node) {
  this[node.type](node);
};

HydrationOpcodeCompiler.prototype.opcode = function (type) {
  var params = [].slice.call(arguments, 1);
  this.opcodes.push([type, params]);
};

HydrationOpcodeCompiler.prototype.startProgram = function (program, c, blankChildTextNodes) {
  this.opcodes.length = 0;
  this.paths.length = 0;
  this.morphs.length = 0;
  this.templateId = 0;
  this.currentDOMChildIndex = -1;
  this.morphNum = 0;

  var blockParams = program.blockParams || [];

  for (var i = 0; i < blockParams.length; i++) {
    this.opcode('printSetHook', blockParams[i], i);
  }

  if (blankChildTextNodes.length > 0) {
    this.opcode('repairClonedNode', blankChildTextNodes);
  }
};

HydrationOpcodeCompiler.prototype.insertBoundary = function (first) {
  this.opcode(first ? 'openBoundary' : 'closeBoundary');
};

HydrationOpcodeCompiler.prototype.endProgram = function () {
  distributeMorphs(this.morphs, this.opcodes);
};

HydrationOpcodeCompiler.prototype.text = function () {
  ++this.currentDOMChildIndex;
};

HydrationOpcodeCompiler.prototype.comment = function () {
  ++this.currentDOMChildIndex;
};

HydrationOpcodeCompiler.prototype.openElement = function (element, pos, len, mustacheCount, blankChildTextNodes) {
  distributeMorphs(this.morphs, this.opcodes);
  ++this.currentDOMChildIndex;

  this.element = this.currentDOMChildIndex;

  this.opcode('consumeParent', this.currentDOMChildIndex);

  // If our parent reference will be used more than once, cache its reference.
  if (mustacheCount > 1) {
    shareElement(this);
  }

  var isElementChecked = detectIsElementChecked(element);
  if (blankChildTextNodes.length > 0 || isElementChecked) {
    this.opcode('repairClonedNode', blankChildTextNodes, isElementChecked);
  }

  this.paths.push(this.currentDOMChildIndex);
  this.currentDOMChildIndex = -1;

  _htmlbarsUtilArrayUtils.forEach(element.attributes, this.attribute, this);
  _htmlbarsUtilArrayUtils.forEach(element.modifiers, this.elementModifier, this);
};

HydrationOpcodeCompiler.prototype.closeElement = function () {
  distributeMorphs(this.morphs, this.opcodes);
  this.opcode('popParent');
  this.currentDOMChildIndex = this.paths.pop();
};

HydrationOpcodeCompiler.prototype.mustache = function (mustache, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount);

  var opcode;

  if (_htmlbarsSyntaxUtils.isHelper(mustache)) {
    prepareHash(this, mustache.hash);
    prepareParams(this, mustache.params);
    preparePath(this, mustache.path);
    opcode = 'printInlineHook';
  } else {
    preparePath(this, mustache.path);
    opcode = 'printContentHook';
  }

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, mustache.escaped]);

  this.opcode(opcode, meta(mustache));
};

function meta(node) {
  var loc = node.loc;
  if (!loc) {
    return [];
  }

  var source = loc.source;
  var start = loc.start;
  var end = loc.end;

  return ['loc', [source || null, [start.line, start.column], [end.line, end.column]]];
}

HydrationOpcodeCompiler.prototype.block = function (block, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount);

  prepareHash(this, block.hash);
  prepareParams(this, block.params);
  preparePath(this, block.path);

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, true]);

  var templateId = this.templateId++;
  var inverseId = block.inverse === null ? null : this.templateId++;

  this.opcode('printBlockHook', templateId, inverseId, meta(block));
};

HydrationOpcodeCompiler.prototype.component = function (component, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount);

  var program = component.program || {};
  var blockParams = program.blockParams || [];

  var attrs = component.attributes;
  for (var i = attrs.length - 1; i >= 0; i--) {
    var name = attrs[i].name;
    var value = attrs[i].value;

    // TODO: Introduce context specific AST nodes to avoid switching here.
    if (value.type === 'TextNode') {
      this.opcode('pushLiteral', value.chars);
    } else if (value.type === 'MustacheStatement') {
      this.accept(_htmlbarsSyntaxUtils.unwrapMustache(value));
    } else if (value.type === 'ConcatStatement') {
      prepareParams(this, value.parts);
      this.opcode('pushConcatHook', this.morphNum);
    }

    this.opcode('pushLiteral', name);
  }

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, true]);

  this.opcode('prepareObject', attrs.length);
  this.opcode('pushLiteral', component.tag);
  this.opcode('printComponentHook', this.templateId++, blockParams.length, meta(component));
};

HydrationOpcodeCompiler.prototype.attribute = function (attr) {
  var value = attr.value;
  var escaped = true;
  var namespace = _htmlbarsUtil.getAttrNamespace(attr.name);

  // TODO: Introduce context specific AST nodes to avoid switching here.
  if (value.type === 'TextNode') {
    return;
  } else if (value.type === 'MustacheStatement') {
    escaped = value.escaped;
    this.accept(_htmlbarsSyntaxUtils.unwrapMustache(value));
  } else if (value.type === 'ConcatStatement') {
    prepareParams(this, value.parts);
    this.opcode('pushConcatHook', this.morphNum);
  }

  this.opcode('pushLiteral', attr.name);

  var attrMorphNum = this.morphNum++;

  if (this.element !== null) {
    shareElement(this);
  }

  this.opcode('createAttrMorph', attrMorphNum, this.elementNum, attr.name, escaped, namespace);
  this.opcode('printAttributeHook');
};

HydrationOpcodeCompiler.prototype.elementModifier = function (modifier) {
  prepareHash(this, modifier.hash);
  prepareParams(this, modifier.params);
  preparePath(this, modifier.path);

  // If we have a helper in a node, and this element has not been cached, cache it
  if (this.element !== null) {
    shareElement(this);
  }

  publishElementMorph(this);
  this.opcode('printElementHook', meta(modifier));
};

HydrationOpcodeCompiler.prototype.pushMorphPlaceholderNode = function (childIndex, childCount) {
  if (this.paths.length === 0) {
    if (childIndex === 0) {
      this.opcode('openBoundary');
    }
    if (childIndex === childCount - 1) {
      this.opcode('closeBoundary');
    }
  }
  this.comment();
};

HydrationOpcodeCompiler.prototype.MustacheStatement = function (mustache) {
  prepareHash(this, mustache.hash);
  prepareParams(this, mustache.params);
  preparePath(this, mustache.path);
  this.opcode('pushSexprHook', meta(mustache));
};

HydrationOpcodeCompiler.prototype.SubExpression = function (sexpr) {
  prepareHash(this, sexpr.hash);
  prepareParams(this, sexpr.params);
  preparePath(this, sexpr.path);
  this.opcode('pushSexprHook', meta(sexpr));
};

HydrationOpcodeCompiler.prototype.PathExpression = function (path) {
  this.opcode('pushGetHook', path.original, meta(path));
};

HydrationOpcodeCompiler.prototype.StringLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.BooleanLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.NumberLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.UndefinedLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.NullLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

function preparePath(compiler, path) {
  compiler.opcode('pushLiteral', path.original);
}

function prepareParams(compiler, params) {
  for (var i = params.length - 1; i >= 0; i--) {
    var param = params[i];
    compiler[param.type](param);
  }

  compiler.opcode('prepareArray', params.length);
}

function prepareHash(compiler, hash) {
  var pairs = hash.pairs;

  for (var i = pairs.length - 1; i >= 0; i--) {
    var key = pairs[i].key;
    var value = pairs[i].value;

    compiler[value.type](value);
    compiler.opcode('pushLiteral', key);
  }

  compiler.opcode('prepareObject', pairs.length);
}

function shareElement(compiler) {
  compiler.opcode('shareElement', ++compiler.elementNum);
  compiler.element = null; // Set element to null so we don't cache it twice
}

function publishElementMorph(compiler) {
  var morphNum = compiler.morphNum++;
  compiler.opcode('createElementMorph', morphNum, compiler.elementNum);
}

function distributeMorphs(morphs, opcodes) {
  if (morphs.length === 0) {
    return;
  }

  // Splice morphs after the most recent shareParent/consumeParent.
  var o;
  for (o = opcodes.length - 1; o >= 0; --o) {
    var opcode = opcodes[o][0];
    if (opcode === 'shareElement' || opcode === 'consumeParent' || opcode === 'popParent') {
      break;
    }
  }

  var spliceArgs = [o + 1, 0];
  for (var i = 0; i < morphs.length; ++i) {
    spliceArgs.push(['createMorph', morphs[i].slice()]);
  }
  opcodes.splice.apply(opcodes, spliceArgs);
  morphs.length = 0;
}
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxiYXJzLWNvbXBpbGVyL2h5ZHJhdGlvbi1vcGNvZGUtY29tcGlsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OzsrQkFBNEIsb0JBQW9COzs7O3FCQUNqQixTQUFTOzs0QkFDUCxrQkFBa0I7O3NDQUMzQiw4QkFBOEI7O21DQUM3QiwwQkFBMEI7O0FBR25ELFNBQVMsc0JBQXNCLENBQUMsT0FBTyxFQUFDO0FBQ3RDLE9BQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBQyxDQUFDLEdBQUMsR0FBRyxFQUFDLENBQUMsRUFBRSxFQUFFO0FBQ3JELFFBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO0FBQzVDLGFBQU8sSUFBSSxDQUFDO0tBQ2I7R0FDRjtBQUNELFNBQU8sS0FBSyxDQUFDO0NBQ2Q7O0FBRUQsU0FBUyx1QkFBdUIsR0FBRztBQUNqQyxNQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNsQixNQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUNoQixNQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUNwQixNQUFJLENBQUMsb0JBQW9CLEdBQUcsQ0FBQyxDQUFDO0FBQzlCLE1BQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLE1BQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLE1BQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLE1BQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Q0FDdEI7O2tCQUVjLHVCQUF1Qjs7QUFFdEMsdUJBQXVCLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUN4RCxNQUFJLGVBQWUsR0FBRywrQkFBcUIsQ0FBQztBQUM1QyxpQkFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENB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LE1BQU0sR0FBRyxDQUFDLENBQUM7Q0FDbkIiLCJmaWxlIjoiaHRtbGJhcnMtY29tcGlsZXIvaHlkcmF0aW9uLW9wY29kZS1jb21waWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUZW1wbGF0ZVZpc2l0b3IgZnJvbSBcIi4vdGVtcGxhdGUtdmlzaXRvclwiO1xuaW1wb3J0IHsgcHJvY2Vzc09wY29kZXMgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHsgZ2V0QXR0ck5hbWVzcGFjZSB9IGZyb20gXCIuLi9odG1sYmFycy11dGlsXCI7XG5pbXBvcnQgeyBmb3JFYWNoIH0gZnJvbSBcIi4uL2h0bWxiYXJzLXV0aWwvYXJyYXktdXRpbHNcIjtcbmltcG9ydCB7IGlzSGVscGVyIH0gZnJvbSBcIi4uL2h0bWxiYXJzLXN5bnRheC91dGlsc1wiO1xuaW1wb3J0IHsgdW53cmFwTXVzdGFjaGUgfSBmcm9tIFwiLi4vaHRtbGJhcnMtc3ludGF4L3V0aWxzXCI7XG5cbmZ1bmN0aW9uIGRldGVjdElzRWxlbWVudENoZWNrZWQoZWxlbWVudCl7XG4gIGZvciAodmFyIGk9MCwgbGVuPWVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgaWYgKGVsZW1lbnQuYXR0cmlidXRlc1tpXS5uYW1lID09PSAnY2hlY2tlZCcpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIEh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyKCkge1xuICB0aGlzLm9wY29kZXMgPSBbXTtcbiAgdGhpcy5wYXRocyA9IFtdO1xuICB0aGlzLnRlbXBsYXRlSWQgPSAwO1xuICB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4ID0gMDtcbiAgdGhpcy5tb3JwaHMgPSBbXTtcbiAgdGhpcy5tb3JwaE51bSA9IDA7XG4gIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gIHRoaXMuZWxlbWVudE51bSA9IC0xO1xufVxuXG5leHBvcnQgZGVmYXVsdCBIeWRyYXRpb25PcGNvZGVDb21waWxlcjtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbihhc3QpIHtcbiAgdmFyIHRlbXBsYXRlVmlzaXRvciA9IG5ldyBUZW1wbGF0ZVZpc2l0b3IoKTtcbiAgdGVtcGxhdGVWaXNpdG9yLnZpc2l0KGFzdCk7XG5cbiAgcHJvY2Vzc09wY29kZXModGhpcywgdGVtcGxhdGVWaXNpdG9yLmFjdGlvbnMpO1xuXG4gIHJldHVybiB0aGlzLm9wY29kZXM7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzW25vZGUudHlwZV0obm9kZSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUub3Bjb2RlID0gZnVuY3Rpb24odHlwZSkge1xuICB2YXIgcGFyYW1zID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICB0aGlzLm9wY29kZXMucHVzaChbdHlwZSwgcGFyYW1zXSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuc3RhcnRQcm9ncmFtID0gZnVuY3Rpb24ocHJvZ3JhbSwgYywgYmxhbmtDaGlsZFRleHROb2Rlcykge1xuICB0aGlzLm9wY29kZXMubGVuZ3RoID0gMDtcbiAgdGhpcy5wYXRocy5sZW5ndGggPSAwO1xuICB0aGlzLm1vcnBocy5sZW5ndGggPSAwO1xuICB0aGlzLnRlbXBsYXRlSWQgPSAwO1xuICB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4ID0gLTE7XG4gIHRoaXMubW9ycGhOdW0gPSAwO1xuXG4gIHZhciBibG9ja1BhcmFtcyA9IHByb2dyYW0uYmxvY2tQYXJhbXMgfHwgW107XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja1BhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgIHRoaXMub3Bjb2RlKCdwcmludFNldEhvb2snLCBibG9ja1BhcmFtc1tpXSwgaSk7XG4gIH1cblxuICBpZiAoYmxhbmtDaGlsZFRleHROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgdGhpcy5vcGNvZGUoJ3JlcGFpckNsb25lZE5vZGUnLCBibGFua0NoaWxkVGV4dE5vZGVzKTtcbiAgfVxufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmluc2VydEJvdW5kYXJ5ID0gZnVuY3Rpb24oZmlyc3QpIHtcbiAgdGhpcy5vcGNvZGUoZmlyc3QgPyAnb3BlbkJvdW5kYXJ5JyA6ICdjbG9zZUJvdW5kYXJ5Jyk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuZW5kUHJvZ3JhbSA9IGZ1bmN0aW9uKCkge1xuICBkaXN0cmlidXRlTW9ycGhzKHRoaXMubW9ycGhzLCB0aGlzLm9wY29kZXMpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLnRleHQgPSBmdW5jdGlvbigpIHtcbiAgKyt0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmNvbW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgKyt0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLm9wZW5FbGVtZW50ID0gZnVuY3Rpb24oZWxlbWVudCwgcG9zLCBsZW4sIG11c3RhY2hlQ291bnQsIGJsYW5rQ2hpbGRUZXh0Tm9kZXMpIHtcbiAgZGlzdHJpYnV0ZU1vcnBocyh0aGlzLm1vcnBocywgdGhpcy5vcGNvZGVzKTtcbiAgKyt0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xuXG4gIHRoaXMuZWxlbWVudCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG5cbiAgdGhpcy5vcGNvZGUoJ2NvbnN1bWVQYXJlbnQnLCB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4KTtcblxuICAvLyBJZiBvdXIgcGFyZW50IHJlZmVyZW5jZSB3aWxsIGJlIHVzZWQgbW9yZSB0aGFuIG9uY2UsIGNhY2hlIGl0cyByZWZlcmVuY2UuXG4gIGlmIChtdXN0YWNoZUNvdW50ID4gMSkge1xuICAgIHNoYXJlRWxlbWVudCh0aGlzKTtcbiAgfVxuXG4gIHZhciBpc0VsZW1lbnRDaGVja2VkID0gZGV0ZWN0SXNFbGVtZW50Q2hlY2tlZChlbGVtZW50KTtcbiAgaWYgKGJsYW5rQ2hpbGRUZXh0Tm9kZXMubGVuZ3RoID4gMCB8fCBpc0VsZW1lbnRDaGVja2VkKSB7XG4gICAgdGhpcy5vcGNvZGUoICdyZXBhaXJDbG9uZWROb2RlJyxcbiAgICAgICAgICAgICAgICAgYmxhbmtDaGlsZFRleHROb2RlcyxcbiAgICAgICAgICAgICAgICAgaXNFbGVtZW50Q2hlY2tlZCApO1xuICB9XG5cbiAgdGhpcy5wYXRocy5wdXNoKHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXgpO1xuICB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4ID0gLTE7XG5cbiAgZm9yRWFjaChlbGVtZW50LmF0dHJpYnV0ZXMsIHRoaXMuYXR0cmlidXRlLCB0aGlzKTtcbiAgZm9yRWFjaChlbGVtZW50Lm1vZGlmaWVycywgdGhpcy5lbGVtZW50TW9kaWZpZXIsIHRoaXMpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmNsb3NlRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xuICBkaXN0cmlidXRlTW9ycGhzKHRoaXMubW9ycGhzLCB0aGlzLm9wY29kZXMpO1xuICB0aGlzLm9wY29kZSgncG9wUGFyZW50Jyk7XG4gIHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXggPSB0aGlzLnBhdGhzLnBvcCgpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLm11c3RhY2hlID0gZnVuY3Rpb24obXVzdGFjaGUsIGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpIHtcbiAgdGhpcy5wdXNoTW9ycGhQbGFjZWhvbGRlck5vZGUoY2hpbGRJbmRleCwgY2hpbGRDb3VudCk7XG5cbiAgdmFyIG9wY29kZTtcblxuICBpZiAoaXNIZWxwZXIobXVzdGFjaGUpKSB7XG4gICAgcHJlcGFyZUhhc2godGhpcywgbXVzdGFjaGUuaGFzaCk7XG4gICAgcHJlcGFyZVBhcmFtcyh0aGlzLCBtdXN0YWNoZS5wYXJhbXMpO1xuICAgIHByZXBhcmVQYXRoKHRoaXMsIG11c3RhY2hlLnBhdGgpO1xuICAgIG9wY29kZSA9ICdwcmludElubGluZUhvb2snO1xuICB9IGVsc2Uge1xuICAgIHByZXBhcmVQYXRoKHRoaXMsIG11c3RhY2hlLnBhdGgpO1xuICAgIG9wY29kZSA9ICdwcmludENvbnRlbnRIb29rJztcbiAgfVxuXG4gIHZhciBtb3JwaE51bSA9IHRoaXMubW9ycGhOdW0rKztcbiAgdmFyIHN0YXJ0ID0gdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbiAgdmFyIGVuZCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG4gIHRoaXMubW9ycGhzLnB1c2goW21vcnBoTnVtLCB0aGlzLnBhdGhzLnNsaWNlKCksIHN0YXJ0LCBlbmQsIG11c3RhY2hlLmVzY2FwZWRdKTtcblxuICB0aGlzLm9wY29kZShvcGNvZGUsIG1ldGEobXVzdGFjaGUpKTtcbn07XG5cbmZ1bmN0aW9uIG1ldGEobm9kZSkge1xuICBsZXQgbG9jID0gbm9kZS5sb2M7XG4gIGlmICghbG9jKSB7IHJldHVybiBbXTsgfVxuXG4gIGxldCB7IHNvdXJjZSwgc3RhcnQsIGVuZCB9ID0gbG9jO1xuICByZXR1cm4gWyAnbG9jJywgW3NvdXJjZSB8fCBudWxsLCBbc3RhcnQubGluZSwgc3RhcnQuY29sdW1uXSwgW2VuZC5saW5lLCBlbmQuY29sdW1uXV0gXTtcbn1cblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmJsb2NrID0gZnVuY3Rpb24oYmxvY2ssIGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpIHtcbiAgdGhpcy5wdXNoTW9ycGhQbGFjZWhvbGRlck5vZGUoY2hpbGRJbmRleCwgY2hpbGRDb3VudCk7XG5cbiAgcHJlcGFyZUhhc2godGhpcywgYmxvY2suaGFzaCk7XG4gIHByZXBhcmVQYXJhbXModGhpcywgYmxvY2sucGFyYW1zKTtcbiAgcHJlcGFyZVBhdGgodGhpcywgYmxvY2sucGF0aCk7XG5cbiAgdmFyIG1vcnBoTnVtID0gdGhpcy5tb3JwaE51bSsrO1xuICB2YXIgc3RhcnQgPSB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xuICB2YXIgZW5kID0gdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbiAgdGhpcy5tb3JwaHMucHVzaChbbW9ycGhOdW0sIHRoaXMucGF0aHMuc2xpY2UoKSwgc3RhcnQsIGVuZCwgdHJ1ZV0pO1xuXG4gIHZhciB0ZW1wbGF0ZUlkID0gdGhpcy50ZW1wbGF0ZUlkKys7XG4gIHZhciBpbnZlcnNlSWQgPSBibG9jay5pbnZlcnNlID09PSBudWxsID8gbnVsbCA6IHRoaXMudGVtcGxhdGVJZCsrO1xuXG4gIHRoaXMub3Bjb2RlKCdwcmludEJsb2NrSG9vaycsIHRlbXBsYXRlSWQsIGludmVyc2VJZCwgbWV0YShibG9jaykpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmNvbXBvbmVudCA9IGZ1bmN0aW9uKGNvbXBvbmVudCwgY2hpbGRJbmRleCwgY2hpbGRDb3VudCkge1xuICB0aGlzLnB1c2hNb3JwaFBsYWNlaG9sZGVyTm9kZShjaGlsZEluZGV4LCBjaGlsZENvdW50KTtcblxuICB2YXIgcHJvZ3JhbSA9IGNvbXBvbmVudC5wcm9ncmFtIHx8IHt9O1xuICB2YXIgYmxvY2tQYXJhbXMgPSBwcm9ncmFtLmJsb2NrUGFyYW1zIHx8IFtdO1xuXG4gIHZhciBhdHRycyA9IGNvbXBvbmVudC5hdHRyaWJ1dGVzO1xuICBmb3IgKHZhciBpID0gYXR0cnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgbmFtZSA9IGF0dHJzW2ldLm5hbWU7XG4gICAgdmFyIHZhbHVlID0gYXR0cnNbaV0udmFsdWU7XG5cbiAgICAvLyBUT0RPOiBJbnRyb2R1Y2UgY29udGV4dCBzcGVjaWZpYyBBU1Qgbm9kZXMgdG8gYXZvaWQgc3dpdGNoaW5nIGhlcmUuXG4gICAgaWYgKHZhbHVlLnR5cGUgPT09ICdUZXh0Tm9kZScpIHtcbiAgICAgIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIHZhbHVlLmNoYXJzKTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICAgIHRoaXMuYWNjZXB0KHVud3JhcE11c3RhY2hlKHZhbHVlKSk7XG4gICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSAnQ29uY2F0U3RhdGVtZW50Jykge1xuICAgICAgcHJlcGFyZVBhcmFtcyh0aGlzLCB2YWx1ZS5wYXJ0cyk7XG4gICAgICB0aGlzLm9wY29kZSgncHVzaENvbmNhdEhvb2snLCB0aGlzLm1vcnBoTnVtKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBuYW1lKTtcbiAgfVxuXG4gIHZhciBtb3JwaE51bSA9IHRoaXMubW9ycGhOdW0rKztcbiAgdmFyIHN0YXJ0ID0gdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbiAgdmFyIGVuZCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG4gIHRoaXMubW9ycGhzLnB1c2goW21vcnBoTnVtLCB0aGlzLnBhdGhzLnNsaWNlKCksIHN0YXJ0LCBlbmQsIHRydWVdKTtcblxuICB0aGlzLm9wY29kZSgncHJlcGFyZU9iamVjdCcsIGF0dHJzLmxlbmd0aCk7XG4gIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIGNvbXBvbmVudC50YWcpO1xuICB0aGlzLm9wY29kZSgncHJpbnRDb21wb25lbnRIb29rJywgdGhpcy50ZW1wbGF0ZUlkKyssIGJsb2NrUGFyYW1zLmxlbmd0aCwgbWV0YShjb21wb25lbnQpKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5hdHRyaWJ1dGUgPSBmdW5jdGlvbihhdHRyKSB7XG4gIHZhciB2YWx1ZSA9IGF0dHIudmFsdWU7XG4gIHZhciBlc2NhcGVkID0gdHJ1ZTtcbiAgdmFyIG5hbWVzcGFjZSA9IGdldEF0dHJOYW1lc3BhY2UoYXR0ci5uYW1lKTtcblxuICAvLyBUT0RPOiBJbnRyb2R1Y2UgY29udGV4dCBzcGVjaWZpYyBBU1Qgbm9kZXMgdG8gYXZvaWQgc3dpdGNoaW5nIGhlcmUuXG4gIGlmICh2YWx1ZS50eXBlID09PSAnVGV4dE5vZGUnKSB7XG4gICAgcmV0dXJuO1xuICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICBlc2NhcGVkID0gdmFsdWUuZXNjYXBlZDtcbiAgICB0aGlzLmFjY2VwdCh1bndyYXBNdXN0YWNoZSh2YWx1ZSkpO1xuICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdDb25jYXRTdGF0ZW1lbnQnKSB7XG4gICAgcHJlcGFyZVBhcmFtcyh0aGlzLCB2YWx1ZS5wYXJ0cyk7XG4gICAgdGhpcy5vcGNvZGUoJ3B1c2hDb25jYXRIb29rJywgdGhpcy5tb3JwaE51bSk7XG4gIH1cblxuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBhdHRyLm5hbWUpO1xuXG4gIHZhciBhdHRyTW9ycGhOdW0gPSB0aGlzLm1vcnBoTnVtKys7XG5cbiAgaWYgKHRoaXMuZWxlbWVudCAhPT0gbnVsbCkge1xuICAgIHNoYXJlRWxlbWVudCh0aGlzKTtcbiAgfVxuXG4gIHRoaXMub3Bjb2RlKCdjcmVhdGVBdHRyTW9ycGgnLCBhdHRyTW9ycGhOdW0sIHRoaXMuZWxlbWVudE51bSwgYXR0ci5uYW1lLCBlc2NhcGVkLCBuYW1lc3BhY2UpO1xuICB0aGlzLm9wY29kZSgncHJpbnRBdHRyaWJ1dGVIb29rJyk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuZWxlbWVudE1vZGlmaWVyID0gZnVuY3Rpb24obW9kaWZpZXIpIHtcbiAgcHJlcGFyZUhhc2godGhpcywgbW9kaWZpZXIuaGFzaCk7XG4gIHByZXBhcmVQYXJhbXModGhpcywgbW9kaWZpZXIucGFyYW1zKTtcbiAgcHJlcGFyZVBhdGgodGhpcywgbW9kaWZpZXIucGF0aCk7XG5cbiAgLy8gSWYgd2UgaGF2ZSBhIGhlbHBlciBpbiBhIG5vZGUsIGFuZCB0aGlzIGVsZW1lbnQgaGFzIG5vdCBiZWVuIGNhY2hlZCwgY2FjaGUgaXRcbiAgaWYgKHRoaXMuZWxlbWVudCAhPT0gbnVsbCkge1xuICAgIHNoYXJlRWxlbWVudCh0aGlzKTtcbiAgfVxuXG4gIHB1Ymxpc2hFbGVtZW50TW9ycGgodGhpcyk7XG4gIHRoaXMub3Bjb2RlKCdwcmludEVsZW1lbnRIb29rJywgbWV0YShtb2RpZmllcikpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLnB1c2hNb3JwaFBsYWNlaG9sZGVyTm9kZSA9IGZ1bmN0aW9uKGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpIHtcbiAgaWYgKHRoaXMucGF0aHMubGVuZ3RoID09PSAwKSB7XG4gICAgaWYgKGNoaWxkSW5kZXggPT09IDApIHtcbiAgICAgIHRoaXMub3Bjb2RlKCdvcGVuQm91bmRhcnknKTtcbiAgICB9XG4gICAgaWYgKGNoaWxkSW5kZXggPT09IGNoaWxkQ291bnQgLSAxKSB7XG4gICAgICB0aGlzLm9wY29kZSgnY2xvc2VCb3VuZGFyeScpO1xuICAgIH1cbiAgfVxuICB0aGlzLmNvbW1lbnQoKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5NdXN0YWNoZVN0YXRlbWVudCA9IGZ1bmN0aW9uKG11c3RhY2hlKSB7XG4gIHByZXBhcmVIYXNoKHRoaXMsIG11c3RhY2hlLmhhc2gpO1xuICBwcmVwYXJlUGFyYW1zKHRoaXMsIG11c3RhY2hlLnBhcmFtcyk7XG4gIHByZXBhcmVQYXRoKHRoaXMsIG11c3RhY2hlLnBhdGgpO1xuICB0aGlzLm9wY29kZSgncHVzaFNleHBySG9vaycsIG1ldGEobXVzdGFjaGUpKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5TdWJFeHByZXNzaW9uID0gZnVuY3Rpb24oc2V4cHIpIHtcbiAgcHJlcGFyZUhhc2godGhpcywgc2V4cHIuaGFzaCk7XG4gIHByZXBhcmVQYXJhbXModGhpcywgc2V4cHIucGFyYW1zKTtcbiAgcHJlcGFyZVBhdGgodGhpcywgc2V4cHIucGF0aCk7XG4gIHRoaXMub3Bjb2RlKCdwdXNoU2V4cHJIb29rJywgbWV0YShzZXhwcikpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLlBhdGhFeHByZXNzaW9uID0gZnVuY3Rpb24ocGF0aCkge1xuICB0aGlzLm9wY29kZSgncHVzaEdldEhvb2snLCBwYXRoLm9yaWdpbmFsLCBtZXRhKHBhdGgpKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5TdHJpbmdMaXRlcmFsID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBub2RlLnZhbHVlKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5Cb29sZWFuTGl0ZXJhbCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgbm9kZS52YWx1ZSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuTnVtYmVyTGl0ZXJhbCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgbm9kZS52YWx1ZSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuVW5kZWZpbmVkTGl0ZXJhbCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgbm9kZS52YWx1ZSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuTnVsbExpdGVyYWwgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIG5vZGUudmFsdWUpO1xufTtcblxuZnVuY3Rpb24gcHJlcGFyZVBhdGgoY29tcGlsZXIsIHBhdGgpIHtcbiAgY29tcGlsZXIub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIHBhdGgub3JpZ2luYWwpO1xufVxuXG5mdW5jdGlvbiBwcmVwYXJlUGFyYW1zKGNvbXBpbGVyLCBwYXJhbXMpIHtcbiAgZm9yICh2YXIgaSA9IHBhcmFtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIHZhciBwYXJhbSA9IHBhcmFtc1tpXTtcbiAgICBjb21waWxlcltwYXJhbS50eXBlXShwYXJhbSk7XG4gIH1cblxuICBjb21waWxlci5vcGNvZGUoJ3ByZXBhcmVBcnJheScsIHBhcmFtcy5sZW5ndGgpO1xufVxuXG5mdW5jdGlvbiBwcmVwYXJlSGFzaChjb21waWxlciwgaGFzaCkge1xuICB2YXIgcGFpcnMgPSBoYXNoLnBhaXJzO1xuXG4gIGZvciAodmFyIGkgPSBwYWlycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgIHZhciBrZXkgPSBwYWlyc1tpXS5rZXk7XG4gICAgdmFyIHZhbHVlID0gcGFpcnNbaV0udmFsdWU7XG5cbiAgICBjb21waWxlclt2YWx1ZS50eXBlXSh2YWx1ZSk7XG4gICAgY29tcGlsZXIub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIGtleSk7XG4gIH1cblxuICBjb21waWxlci5vcGNvZGUoJ3ByZXBhcmVPYmplY3QnLCBwYWlycy5sZW5ndGgpO1xufVxuXG5mdW5jdGlvbiBzaGFyZUVsZW1lbnQoY29tcGlsZXIpIHtcbiAgY29tcGlsZXIub3Bjb2RlKCdzaGFyZUVsZW1lbnQnLCArK2NvbXBpbGVyLmVsZW1lbnROdW0pO1xuICBjb21waWxlci5lbGVtZW50ID0gbnVsbDsgLy8gU2V0IGVsZW1lbnQgdG8gbnVsbCBzbyB3ZSBkb24ndCBjYWNoZSBpdCB0d2ljZVxufVxuXG5mdW5jdGlvbiBwdWJsaXNoRWxlbWVudE1vcnBoKGNvbXBpbGVyKSB7XG4gIHZhciBtb3JwaE51bSA9IGNvbXBpbGVyLm1vcnBoTnVtKys7XG4gIGNvbXBpbGVyLm9wY29kZSgnY3JlYXRlRWxlbWVudE1vcnBoJywgbW9ycGhOdW0sIGNvbXBpbGVyLmVsZW1lbnROdW0pO1xufVxuXG5mdW5jdGlvbiBkaXN0cmlidXRlTW9ycGhzKG1vcnBocywgb3Bjb2Rlcykge1xuICBpZiAobW9ycGhzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIFNwbGljZSBtb3JwaHMgYWZ0ZXIgdGhlIG1vc3QgcmVjZW50IHNoYXJlUGFyZW50L2NvbnN1bWVQYXJlbnQuXG4gIHZhciBvO1xuICBmb3IgKG8gPSBvcGNvZGVzLmxlbmd0aCAtIDE7IG8gPj0gMDsgLS1vKSB7XG4gICAgdmFyIG9wY29kZSA9IG9wY29kZXNbb11bMF07XG4gICAgaWYgKG9wY29kZSA9PT0gJ3NoYXJlRWxlbWVudCcgfHwgb3Bjb2RlID09PSAnY29uc3VtZVBhcmVudCcgIHx8IG9wY29kZSA9PT0gJ3BvcFBhcmVudCcpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHZhciBzcGxpY2VBcmdzID0gW28gKyAxLCAwXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtb3JwaHMubGVuZ3RoOyArK2kpIHtcbiAgICBzcGxpY2VBcmdzLnB1c2goWydjcmVhdGVNb3JwaCcsIG1vcnBoc1tpXS5zbGljZSgpXSk7XG4gIH1cbiAgb3Bjb2Rlcy5zcGxpY2UuYXBwbHkob3Bjb2Rlcywgc3BsaWNlQXJncyk7XG4gIG1vcnBocy5sZW5ndGggPSAwO1xufVxuIl19